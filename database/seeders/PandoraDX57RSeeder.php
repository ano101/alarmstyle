<?php

namespace Database\Seeders;

use App\Models\Attribute;
use App\Models\AttributeValue;
use App\Models\Product;
use Illuminate\Database\Console\Seeds\WithoutModelEvents;
use Illuminate\Database\Seeder;

class PandoraDX57RSeeder extends Seeder
{
    use WithoutModelEvents;

    /**
     * Run the database seeds.
     *
     * Характеристики Pandora DX 57R:
     * - Двусторонняя сигнализация с ЖК-брелоком и автозапуском
     * - Диалоговый код, встроенный датчик удара и наклона
     * - Автозапуск по температуре, времени, интервалу и напряжению
     * - CAN-интерфейс опционально
     * - Дальность до 2000 м
     */
    public function run(): void
    {
        $product = Product::query()->where('name', 'Автосигнализация Pandora DX 57R')->firstOrFail();

        /**
         * Карта: название атрибута => точное значение из таблицы attribute_values.
         *
         * @var array<string, string> $specs
         */
        $specs = [
            // --- Комплектация ---
            'Центральный блок' => 'Есть',
            'ЖК брелок' => 'Есть',
            'Дополнительный брелок' => 'Нет',
            'Брелок-метка' => 'Есть',
            'Количество брелков-меток' => '1',
            'Защитный чехол на брелок' => 'Нет',
            'Сирена' => 'Нет',

            // --- Датчики ---
            'Датчик удара и его тип' => '2-х уровневый встроенный цифровой',
            'Датчик изменения объёма салона' => 'Нет',
            'Датчик перемещения/ускорения' => 'встроенный',
            'Температурный датчик' => 'Есть',

            // --- Автозапуск ---
            'Модуль автозапуска' => 'Есть',
            'Поддержка автозапуска без обходчика*' => 'Нет',
            'Режим "турботаймера"' => 'Есть',
            'Автоматический запуск двигателя через интервал (час)' => 'Есть',
            'Автоматический запуск двигателя по температуре в салоне (град.)' => 'Есть',
            'Автоматический запуск двигателя по температуре двигателя (град.)' => 'Есть',
            'Автоматический запуск двигателя по напряжению бортовой сети' => 'Есть',
            'Автоматический запуск двигателя по реальному времени' => 'Есть',
            'Дистанционный запуск двигателя' => 'Есть',
            'Охрана автомобиля с заведённым двигателем' => 'есть, без ключа в замке зажигания',

            // --- Функции охраны ---
            'Микрофон' => 'Нет',
            'Персональный PIN-код аварийного отключения' => 'Есть',
            'Режим Valet' => 'Есть',
            'Режим Anti-Hi-Jack' => 'есть, автоматический режим включения',
            'Открытие только двери водителя при снятии с охраны' => 'Есть',
            'Цифровое реле блокировки двигателя' => 'есть, управляется кодированным сигналом по отдельному проводу',
            'Функция "свободные руки"' => 'Есть',
            'Режим поиска автомобиля' => 'Есть',
            'Закрытие замков дверей по скорости' => 'Есть',
            'Бесшумное включение/выключение режима охраны' => 'Есть',

            // --- Брелок ---
            'Тип управляющего кода' => 'диалоговый',
            'Контроль канала связи' => 'Есть',
            'Число кнопок брелка' => '3',
            'Вибро режим в брелке' => 'Есть',
            'Режим напоминания о пропущенной тревоге на брелке' => 'Есть',
            'Часы в брелке' => 'Есть',
            'Подсветка ЖК-дисплея брелока' => 'Есть',
            'Индикация напряжения аккумулятора автомобиля' => 'Есть',
            'Индикация температуры в салоне автомобиля' => 'Есть',
            'Индикация разряда батареи брелока' => 'Есть',

            // --- Интерфейсы ---
            'Интегрированный CAN-интерфейс' => 'Опция',
            'Интегрированный GSM-модуль' => 'Нет',
            'Управление штатным брелком Slave-режим' => 'Нет',
            'Работа с кнопкой запуска старт-стоп' => 'Есть',
            'Модуль управление замком капота' => 'Нет',
            'Bluetooth интерфейс' => 'Нет',
            'Управление по GSM' => 'Нет',
            'Получение данных GPS' => 'Нет',

            // --- Прочее ---
            'Рабочее напряжение питания' => '9-18',
            'Страна изготовитель' => 'Россия',
            'Сайт фирмы-производителя' => 'www.alarmtrade.ru',
            'Срок гарантии (мес.)' => '36',
            'Дальность действия (оповещение)' => '2000',
            'Производитель' => 'Pandora',
        ];

        // Отвязываем все старые значения
        $product->attributeValues()->detach();

        foreach ($specs as $attrName => $valueName) {
            $attribute = Attribute::query()->where('name', $attrName)->first();

            if (! $attribute) {
                $this->command->warn("Атрибут не найден: «{$attrName}»");

                continue;
            }

            $attributeValue = AttributeValue::query()
                ->where('attribute_id', $attribute->id)
                ->where('value', $valueName)
                ->first();

            if (! $attributeValue) {
                $this->command->warn("Значение «{$valueName}» не найдено для атрибута «{$attrName}» — пропускаем.");

                continue;
            }

            $product->attributeValues()->attach($attributeValue->id);
        }

        $this->command->info("Атрибуты товара «{$product->name}» успешно заполнены.");
    }
}

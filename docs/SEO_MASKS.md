# SEO Маски - Руководство

## Обзор

SEO маски позволяют автоматически генерировать SEO метатеги (title, description, h1) для различных сущностей приложения на основе шаблонов с переменными.

## Контексты

- `product` - страница товара
- `catalog_category` - страница каталога/категории
- `landing` - посадочная страница

## Доступные переменные

### Для товаров (Product)

| Переменная | Описание | Пример значения |
|------------|----------|-----------------|
| `{name}` | Название товара | "Сигнализация StarLine A93" |
| `{price}` | Базовая цена товара | "15990" |
| `{category}` | Основная категория товара | "Автосигнализации" |
| `{article}` | Артикул товара | "SL-A93-2CAN" |
| `{attr_ID}` | Значение атрибута по ID | `{attr_5}` → "StarLine" (если ID=5 это бренд) |

**Примеры шаблонов для товара:**

```
Title: Купить {name} по цене {price} руб | {category}
H1: {name} - {attr_5}
Description: Купить {name} по выгодной цене {price} руб. Бренд {attr_5}. Доставка по всей России.
```

### Для категорий (Category)

| Переменная | Описание | Пример значения |
|------------|----------|-----------------|
| `{category}` | Название категории | "Автосигнализации" |
| `{category_lc}` | Название категории в нижнем регистре | "автосигнализации" |
| `{parent}` | Родительская категория | "Сигнализации" |
| `{filters}` | Текст выбранных фильтров | "Бренд: StarLine; GSM: Есть" |
| `{price_from}` | Минимальная цена из фильтра | "5000" |
| `{price_to}` | Максимальная цена из фильтра | "20000" |
| `{sort_label}` | Текущая сортировка | "сначала дешевле" |
| `{page}` | Номер страницы | "2" |

**Примеры шаблонов для категории:**

```
Title: {category} в Москве - купить {category_lc} недорого
H1: {category} {filters}
Description: Каталог {category_lc} - подбор по параметрам и цене. {filters}
```

### Для посадочных страниц (CategoryLanding)

Использует те же переменные, что и категория, так как лендинг привязан к категории с набором фильтров.

## Создание маски в админке

1. Перейдите в раздел "SEO Маски"
2. Нажмите "Создать"
3. Заполните поля:
   - **Контекст** - укажите контекст применения (`product`, `catalog_category`)
   - **Связанная сущность** - выберите конкретную сущность или оставьте пустым для глобальной маски
   - **Шаблоны** - используйте переменные в фигурных скобках

## Приоритеты применения SEO

1. **SeoMeta** - явно заданные метатеги для конкретной сущности (высший приоритет)
2. **SeoMask (specific)** - маска для конкретной сущности (например, для категории ID=5)
3. **SeoMask (global)** - глобальная маска для контекста
4. **Фоллбек** - значения по умолчанию из кода

## Примеры использования

### Глобальная маска для всех товаров

```
Контекст: product
Связанная сущность: (не выбрано)
Title: Купить {name} по цене {price} руб - интернет-магазин
H1: {name}
Description: {name} по выгодной цене {price} руб. Доставка по всей России.
```

### Маска для конкретной категории

```
Контекст: catalog_category
Связанная сущность: Категория "Автосигнализации"
Title: Автосигнализации с установкой в Москве | Купить {category_lc} недорого
H1: {category} {filters}
Description: Установка {category_lc} в Москве. {filters}. Гарантия качества.
```

### Использование атрибутов товара

Чтобы использовать атрибут в маске, нужно знать его ID:

1. Перейдите в раздел "Атрибуты"
2. Найдите нужный атрибут (например, "Бренд")
3. Посмотрите ID в URL или в списке (например, ID=5)
4. Используйте `{attr_5}` в шаблоне

**Пример:**

```
Title: Купить {name} {attr_5} по цене {price} руб
```

где `attr_5` - это бренд товара.

## Технические детали

### Как работает рендеринг маски

1. Берется шаблон, например: `"Купить {name} за {price} руб"`
2. Все переменные заменяются на реальные значения: `"Купить StarLine A93 за 15990 руб"`
3. Неиспользованные переменные удаляются
4. Множественные пробелы схлопываются в один

### NoIndex для категорий

- Чистая категория без фильтров - **индексируется**
- Категория + лендинг - **индексируется**
- Категория + фильтры без лендинга - **noindex** (маски все равно применяются)
- Любые GET параметры - **noindex**
- Пагинация (page > 1) - **noindex**

## Частые вопросы

**Q: Как узнать ID атрибута?**
A: Откройте список атрибутов в админке и посмотрите ID в URL или таблице.

**Q: Можно ли использовать несколько атрибутов в одном шаблоне?**
A: Да, например: `{name} {attr_5} {attr_7} за {price} руб`

**Q: Что если переменная пустая?**
A: Она будет удалена из результата, и лишние пробелы будут убраны автоматически.

**Q: Как создать маску только для одного товара?**
A: Выберите конкретный товар в поле "Связанная сущность" при создании маски.
